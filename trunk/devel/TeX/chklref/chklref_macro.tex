%% -*-mode: tex-mode -*-

\makeatletter
\gdef\currentfile{\jobname.tex}

\newwrite\chk@write
\immediate\openout\chk@write\jobname.tex.chk%
\def\chk@print#1{%
  \immediate\write\chk@write{#1}%
}

\let\include@orig=\include
\def\include#1{\gdef\currentfile{#1}%
        \include@orig #1}

\let\input@orig=\input
\def\Input#1{\gdef\currentfile{#1}%
\input #1}

\let\begin@orig=\begin
\def\begin#1{%
        \chk@print{begin{#1} line \the\inputlineno\space file \currentfile}%
        \begin@orig{#1}%
}

\let\end@orig=\end
\def\end#1{%
        \chk@print{end{#1} line \the\inputlineno\space file \currentfile}%
        \end@orig{#1}%
}


\let\ref@orig=\ref
\let\label@orig=\label
\def\label#1{%
  \chk@print{label #1 line \the\inputlineno\space file \currentfile}
  \label@orig{#1}}

\def\ref#1{%
  \chk@print{ref #1 line \the\inputlineno\space file \currentfile}
  \ref@orig{#1}}

\makeatother
