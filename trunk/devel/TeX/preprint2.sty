%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Jérôme LELONG                                                       %% 
%% CERMICS (ENPC)                                                      %%
%% http://cermics.enpc.fr/~lelong                                      %%
%% Ce paquet permet de rajouter une page de garde aux preprints        %%
%% du CERMICS.                                                         %%
%% Utilisation:                                                        %%
%% rajouter dans l'en-tête du.tex                                      %%
%%     \usepackage{preprint}                                           %%
%% puis avant la commande \maketitle                                   %%
%%      \pauthor[1]{premier auteur}                                    %%
%%      \paddress[1]{adresse premier auteur}                           %%
%%    et ainsi de suite pour les autres auteurs.                       %%
%% Si l'auteur  a la même adresse que l'auteur 1, alors on déclare     %%
%% d'abord les noms de auteurs ayant la même adresse et ensuite        %%
%% \pauthor[1]{second auteur}.                                         %%
%%                                                                     %%
%% Si un auteur a une adresse commune avec un autre et une             %%
%% adresse propre, alors on utilisera                                  %%
%% \pauthor[1,2]{auteur 3}                                             %%
%% \paddress[2]{adresse propre de l'auteur 3}                          %%
%%                                                                     %%
%% L'ordre d'apparition des commandes \pautthor et \paddress           %%
%% importe peu.                                                        %%
%%                                                                     %%
%% Déclarer le titre avec la commande                                  %%
%%     \ptitle{titre de l'article}                                     %%
%%                                                                     %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\ProvidesPackage{preprint}[21/12/2005 revision 1.1 by Jérôme LELONG]
\NeedsTeXFormat{LaTeX2e}



%% for details on atxy see
%% http://www-sop.inria.fr/apics/tralics/raweb.html
%%
\newbox\@atxybox%
\def\atxy(#1,#2)#3{\global\setbox\@atxybox=\hbox%
 {\unhbox\@atxybox
  \vtop to 0pt{\kern #2\hbox to 0pt{\kern #1\relax #3\hss}\vss}}}%

\def\@useatxy{%
  \vtop to 0pt{\kern-\headsep \kern-\topmargin \kern-\headheight
               \kern-1in \kern-\voffset
    \hbox to 0pt{\kern-\@themargin \kern-1in \kern-\hoffset
    \unhbox\@atxybox \hss}\vss}%
  \global\let\@texttop\relax}

\toks0={\setbox255=\vbox{\@useatxy \unvbox255}}
\output=\expandafter{\the\toks0\the\output}

\let\@ptitle\@empty
\let\@pauthors\@empty
\let\@paddresses\@empty
\let\@pnr\@empty
\def\@pdate{\number\day}


\newcommand{\pmonthname}[1]{%
\ifcase#1
\or Janvier%
\or Février%
\or Mars%
\or Avril%
\or Mai%
\or Juin%
\or Juillet%
\or Août%
\or Septembre%
\or Octobre%
\or Novembre%
\or Décembre%
\fi}


\def\@pdate{\pmonthname{\month}\space\number\year}

%%font definitions
\def\ptitle@font
{\fontfamily{cmr}\fontencoding{T1}\fontseries{b}\fontshape{n}\fontsize{25}{30pt}\selectfont}

\def\pauthor@font
{\fontfamily{cmr}\fontencoding{T1}\fontseries{m}\fontshape{n}\fontsize{14.4}{18pt}\selectfont}

\def\paddress@font
{\fontfamily{cmr}\fontencoding{T1}\fontseries{m}\fontshape{it}\fontsize{12}{13.6pt}\selectfont}

\def\pnormal@font
{\fontfamily{cmr}\fontencoding{T1}\fontseries{m}\fontshape{n}\fontsize{12}{13.6pt}\selectfont}


\def\pheader@font
{\fontfamily{cmr}\fontencoding{T1}\fontseries{m}\fontshape{n}\fontsize{10}{12pt}\selectfont}



%% to number author

\newcounter{total@pauthors}
\setcounter{total@pauthors}{0}
\newcounter{n@pauthors}
\setcounter{n@pauthors}{0}

\newcommand{\paddress}[2][]{
  \g@addto@macro\@paddresses{\paddress{#1}{#2}}}

\newcommand{\pauthor}[2][]{
  \stepcounter{total@pauthors}
  \g@addto@macro\@pauthors{\pauthor{#1}{#2}}}


  
\def\ptitle#1{
  \def\@ptitle{#1}}

\def\pnumber#1{
  \def\@pnr{#1}
}

\def\@setpaddresses{%
  \begingroup%
  \def\paddress##1##2{%
    \vspace*{15pt}%
    \par\noindent {\paddress@font %
    \@ifnotempty{##1}{$^{##1}$}%
    ##2}
  }%
  \@paddresses
  \endgroup
}

\def\@setpauthors{%
  \begingroup%
  {\setlength{\baselineskip}{28pt}%
  \def\pauthor##1##2{%
    \stepcounter{n@pauthors}%
    \ifnum\then@pauthors=\thetotal@pauthors%
       \ifnum\thetotal@pauthors>1%
         {\pnormal@font \space\&~}\fi
    \else
      \ifnum\then@pauthors>1%
        {\pauthor@font,\space}\fi
    \fi
    {\pauthor@font ##2%
      \@ifnotempty{##1}{$^{##1}$\relax}}%
  }%
  \@pauthors
  \par}%
  \endgroup
}



\def\@setptitle{
  {\ptitle@font
    \@ptitle
    \par
    \vspace*{50pt}}
}


\let\orig@maketitle\maketitle

\def\maketitle{
  \@pmaketitle
  \orig@maketitle
}

\def\@pmaketitle{%
  {\pnormal@font
  \thispagestyle{empty}
  \atxy(3cm,3cm){%
    \begin{minipage}[c][24.5cm][t]{15cm}
      {\pheader@font
        \nobreak\noindent
        Rapport de recherche du CERMICS
        \ifx\@empty\@pnr\else \space NR:\space \@pnr \fi
        \hfill \@pdate
        \newline
        \vspace{4pt}\noindent\rule{\linewidth}{1pt}
        \vspace{\stretch{1}}}%
      \begin{center}%
      \@setptitle
      \ifx\@empty\pauthors\else \@setpauthors\fi
      \end{center}
      \vspace{\stretch{1}}
      \ifx\@empty\paddresses\else \@setpaddresses\fi
      {\paddress@font
      \vspace{60pt}%
      \noindent
        \begin{center}
          CERMICS \textemdash\ ENPC\\%
          6 et 8 avenue Blaise Pascal\\%
          Cité Descartes - Champs sur Marne\\%
          77455 Marne la Vallée Cedex 2%
          \vspace*{10pt}
          \centerline{http://cermics.enpc.fr}
        \end{center}}
    \end{minipage}
  }%
  \null
  \newpage
  \thispagestyle{empty}
  \null
  \newpage
  \setcounter{page}{1}
  }
  \normalsize%  
} 

\endinput