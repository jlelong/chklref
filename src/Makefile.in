#
# Jérôme Lelong <jerome.lelong@gmail.com>
# 
# 2008-2010.
#

.PHONY: all clean distclean install uninstall

INSTALL=@INSTALL@
PDFLATEX=@pdflatex_path@
LATEX=@latex_path@

PKGNAME=@PKGNAME@
prefix=@prefix@
bindir=@bindir@
LATEXDIR=@LATEXDIR@
DOCDIR=@DOCDIR@
SCRIPTSDIR=@SCRIPTSDIR@

SCRIPTS=chkparser
BINFILES=chklref
TEXFILES=chklref.sty
DOCFILES=chklref.pdf


all: chklref.pdf clean

install: all
	if ! test -d $(DESTDIR)$(bindir); then $(INSTALL) -d $(DESTDIR)$(bindir); fi
	$(INSTALL) -m 755 $(BINFILES) $(DESTDIR)$(bindir)
	if ! test -d $(DESTDIR)$(SCRIPTSDIR); then $(INSTALL) -d $(DESTDIR)$(SCRIPTSDIR); fi
	$(INSTALL) -m 755 $(SCRIPTS) $(DESTDIR)$(SCRIPTSDIR)
	if ! test -d $(DESTDIR)$(LATEXDIR); then $(INSTALL) -d $(DESTDIR)$(LATEXDIR); fi
	$(INSTALL) -m 644 $(TEXFILES) $(DESTDIR)$(LATEXDIR)
	if ! test -d $(DESTDIR)$(DOCDIR); then $(INSTALL) -d $(DESTDIR)$(DOCDIR); fi
	$(INSTALL) -m 644 $(DOCFILES) $(DESTDIR)$(DOCDIR)


define chk_rm
@for f in $(2); do echo "uninstalling $(1)/$$f"; $(RM) $(1)/$$f; done
endef

uninstall:
	$(call chk_rm, $(bindir), $(DESTDIR)$(BINFILES))
	$(call chk_rm, $(DOCDIR), $(DESTDIR)$(DOCFILES))
	$(call chk_rm, $(LATEXDIR), $(DESTDIR)$(TEXFILES))
	$(call chk_rm, $(SCRIPTSDIR), $(DESTDIR)$(SCRIPTS))


chklref.pdf: chklref.tex
	$(PDFLATEX) $<
	$(PDFLATEX) $<

clean:
	$(RM) chklref.dvi chklref.log chklref.aux chklref.out 

distclean: clean
	$(RM) chklref

